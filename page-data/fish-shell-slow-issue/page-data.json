{"componentChunkName":"component---src-templates-blog-post-js","path":"/fish-shell-slow-issue/","result":{"data":{"site":{"siteMetadata":{"title":"p3t.lu"}},"markdownRemark":{"id":"569b5ba1-e0a6-559e-b058-18a4738f2bb4","excerpt":"fish shell 從之前的 Linux 使用到現在的 macOS 一直都是速度非常快的，尤其是裝了幾個常用的外掛也不曾感到變慢過。(例如 git 外掛在切換到 git 資料夾時的體感速度) 這週在讀書會帶工作坊的時候，因為要開很多 terminal…","html":"<p><a href=\"https://fishshell.com/\">fish shell</a> 從之前的 Linux 使用到現在的 macOS 一直都是速度非常快的，尤其是裝了幾個常用的外掛也不曾感到變慢過。(例如 git 外掛在切換到 git 資料夾時的體感速度)</p>\n<p>這週在讀書會帶工作坊的時候，因為要開很多 terminal 做不同的操作才意識到「靠… 怎麼變那麼慢。」，每開一個新的 shell 心裡就會靠一次… 開 shell 還要等真的是會讓人很不爽。</p>\n<p>只好拜請 Google 大神看看有沒有解，後來找到這篇「<a href=\"https://github.com/fish-shell/fish-shell/issues/5980\">MacOS 10.15 Beta - Slow Fish Prompts #5980</a>」，雖然都是變慢但跟我的 root cause 不一樣，但裡面有提到 fish shell profiling 的方法：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">fish --profile /tmp/profile -c fish_prompt; sort -nk2 /tmp/profile</code></pre></div>\n<p>然後我的執行結果如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">…以上略…\n138     52399   ---------> test -e (brew --prefix)/Cellar/nvm\n19      59575   -> if [ (_git_branch_name) ]\n63140   63140   -----> command grep --color=auto $argv\n160     68979   > fish_prompt\n5994    92279   ----> ps -ef | grep $SSH_AGENT_PID | grep -v grep | grep -q ssh-agent\n39      92452   ---> not __ssh_agent_is_started\n4       92456   --> if not __ssh_agent_is_started\n99      92853   -> fish_ssh_agent\n174     130993  > builtin source /Users/peter_br_lu/.config/fish/config.fish\n705586  705586  -------------> bash -c \"$program &amp;&amp; echo &amp;&amp; echo '$divider' &amp;&amp; env\" 2>&amp;1\n277     705863  ------------> set program_execution (bash -c \"$program &amp;&amp; echo &amp;&amp; echo '$divider' &amp;&amp; env\" 2>&amp;1)\n179     738392  -----------> fenv.main $argv\n12      745890  ----------> if test (count $argv) -gt 0\n90      745980  ---------> fenv source $nvm_prefix/nvm.sh >/dev/null 2>&amp;1\n883646  883646  ----------> brew --prefix nvm\n216     883862  ---------> set -g nvm_prefix (brew --prefix nvm)\n21      1686271 --------> if type -q fenv\n40      1686311 -------> init /Users/peter_br_lu/.local/share/omf/pkg/nvm\n139     1686450 ------> emit init_$package $path\n237     1716659 -----> for init in $init_path\n431     1722284 ----> require --path {$OMF_PATH,$OMF_CONFIG}/pkg/*\n517     1726529 ---> source $OMF_PATH/init.fish\n275     1726911 --> source $file\n589     1728200 -> for file in $__fish_config_dir/conf.d/*.fish $__fish_sysconf_dir/conf.d/*.fish $vendor_confdirs/*.fish\n1378    1736909 > builtin source /usr/local/Cellar/fish/3.1.2/share/fish/config.fish</code></pre></div>\n<p>第一行是 time，第二行是 sum，第三行是 command</p>\n<p>然後我就用時間排序一下</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">…以上略…\n555     555     -----> set conf_path $package_path/conf.d/*.fish\n586     21317   -> fish_vi_key_bindings\n589     1728200 -> for file in $__fish_config_dir/conf.d/*.fish $__fish_sysconf_dir/conf.d/*.fish $vendor_confdirs/*.fish\n601     601     -----> set init_path $package_path/init.fish*\n606     606     -----> set complete_path $package_path/completions*\n622     643     ----------> source /usr/local/Cellar/fish/3.1.2/share/fish/functions/type.fish\n642     655     --> source /usr/local/Cellar/fish/3.1.2/share/fish/functions/__fish_set_locale.fish\n648     648     -----> set function_path $package_path/functions*\n696     5409    ----------------> for value in $argv\n699     699     ----> set -l theme_function_path {$OMF_CONFIG,$OMF_PATH}/themes*/$theme{,/functions}\n699     731     ----> source /usr/local/Cellar/fish/3.1.2/share/fish/functions/__fish_shared_key_bindings.fish\n1372    1386    --> source /usr/local/Cellar/fish/3.1.2/share/fish/functions/fish_vi_key_bindings.fish\n1378    1736909 > builtin source /usr/local/Cellar/fish/3.1.2/share/fish/config.fish\n5994    92279   ----> ps -ef | grep $SSH_AGENT_PID | grep -v grep | grep -q ssh-agent\n6973    6973    -----> command grep --color=auto $argv\n7065    7065    -------> echo | command grep --color=auto \"\" >/dev/null 2>&amp;1\n7088    7088    -------------> echo $argv | sed 's/[ \\t]//g'\n7778    7778    --> pwd | sed \"s:^$HOME:~:\"\n8946    8946    -----> command grep --color=auto $argv\n9110    9110    --> tty\n12417   12417   -------------> bash -c 'env'\n15441   15441   --------> not which autojump >/dev/null ^/dev/null\n16406   16406   -----> command git symbolic-ref HEAD 2> /dev/null | sed -e 's|^refs/heads/||'\n19165   19165   ------> command git status -s --ignore-submodules=dirty 2> /dev/null\n22741   22741   -----> command git symbolic-ref HEAD 2> /dev/null | sed -e 's|^refs/heads/||'\n52261   52261   ----------> brew --prefix\n63140   63140   -----> command grep --color=auto $argv\n705586  705586  -------------> bash -c \"$program &amp;&amp; echo &amp;&amp; echo '$divider' &amp;&amp; env\" 2>&amp;1\n883646  883646  ----------> brew --prefix nvm</code></pre></div>\n<p>從最下面往上逐一檢視</p>\n<p>疑… nvm！！！</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">883646  883646  ----------> brew --prefix nvm</code></pre></div>\n<p>手動執行了一下還真的是有點慢的感覺…</p>\n<p>所以我就試著把 <a href=\"https://github.com/oh-my-fish/oh-my-fish\">Oh My Fish!</a> 裝的 nvm 外掛移掉試試，果然變快了！如下圖：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; border-style: solid; border-width: thin; border-color: #334747;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACVElEQVQ4y32S3W7TMBiG0yW2k8Z/SdMl6brRUtKoYpuE0Ng44Bq4Ds44WCsmbaMMiU1o2qXmcyoM2RmyWwao3Q4e+fuJXr+RX+frp4+/Tr+d3V9eXTfzm9vm881tM/9+15zf3N1PL6+a07Pz5vTiSzO7ur6fzmbNdDptzi8umvl8vsZsNmscx9mqHMdZ0VqdXuVs4cppucu+5S15+O4J4jgCKQVQSoGGbRCcA6MhcEahHfjg+8T2kRQQhm3wfR+CIHgUJ09ytb+/Xw+HQzUuy/rw8LAejUZ1UYzryWRSDwYDZTDzoijqNE0VQqgihMAmHDmJa8EpcBqCFAKklMA5tyRJAnEcW/dCCIiiCBhjgDG2ghjjNRz5Ol8gJsCjErw2BQ+hCllw5XmeBWFsZ7ZeuTOiGwWTN88XrP9M8cELRdOe4lmmQimAeFsVwagixg3ylqx+60mH8dt8QTgHQkIgTALmMWDZBRynytQkZIBFB3DUBeL7YC7Af4XXBb2WX6GQAw4oICNIBSAeA5IJYNO3KWAWATKi/7vb6NJhnEHb921EDAEh0PYJBARb/FVvCQIbm39F1wR727kaj8d1b2dH7e3tKRMNE6HtNLVzExPzwoPBUJVlWZtXfzI2fBiprJerpNOBbrer+v2+MqcRMhfs7u4qExfT93o9u3tMzArm77IfGLmV6y4j4rruQ1xMbTCOzP7PDq9itAnnw/ti8epl+XNUjHVZjnWe5zqOY80Y01JKzTnXlPq60wm0EExnWabTNNVFUVgODg70ycmJPjo60sfHx/o3FfxMzZyOukoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fish shell slow issue\"\n        title=\"fish shell slow issue\"\n        src=\"/static/a031325a31675457e419b556eb1d99c5/f058b/fish-shell-slow-issue.png\"\n        srcset=\"/static/a031325a31675457e419b556eb1d99c5/c26ae/fish-shell-slow-issue.png 158w,\n/static/a031325a31675457e419b556eb1d99c5/6bdcf/fish-shell-slow-issue.png 315w,\n/static/a031325a31675457e419b556eb1d99c5/f058b/fish-shell-slow-issue.png 630w,\n/static/a031325a31675457e419b556eb1d99c5/40601/fish-shell-slow-issue.png 945w,\n/static/a031325a31675457e419b556eb1d99c5/78612/fish-shell-slow-issue.png 1260w,\n/static/a031325a31675457e419b556eb1d99c5/5faa8/fish-shell-slow-issue.png 1444w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>執行時間從 2.33<strong>s</strong> 變成 221.41<strong>ms</strong>！！！</p>\n<h2>舒服！</h2>\n<p>好吧，只好先這樣，有要用 nvm 的時候再裝回來好惹…</p>","frontmatter":{"title":"解決我的 fish shell 變慢的問題","date":"June 24, 2020","description":null}},"previous":{"fields":{"slug":"/awesome-tool-boop/"},"frontmatter":{"title":"發現超好用小工具 Boop！如果沒有它，在 CLI 要如何解決？"}},"next":{"fields":{"slug":"/macos-alfred/"},"frontmatter":{"title":"傳說中的神器 Alfred"}}},"pageContext":{"id":"569b5ba1-e0a6-559e-b058-18a4738f2bb4","previousPostId":"61eda477-6bec-5a41-9bdd-eab4dbfb2980","nextPostId":"008f1a8b-46e6-5a87-8e8e-440a8d657771"}},"staticQueryHashes":["3624854548","548598555"]}